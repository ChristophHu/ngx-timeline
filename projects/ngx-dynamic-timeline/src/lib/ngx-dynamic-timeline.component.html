<div class="relative flex flex-row grow h-full text-dark overflow-auto"> 
  <timeline-panel
    (widthChanged)="panelWidth = $event"
    [maxWidth]="400"
    [minWidth]="50"
    [resizable]="isPanelResizable"></timeline-panel>
    <!-- [laneTemplate]="panelLaneTemplate"
    [items]="itemsIterator.items"
    [lanes]="lanes">
  </timeline-panel> -->
  <!-- [itemTemplate]="panelItemTemplate" -->
    
    <!-- lanes -->
    <!-- <div class="relative flex h-10 top-[64px] bg-green-200 items-center text-center">
      <span>First Lane</span>
    </div> -->

    <div class="relative min-h-full">
      <!-- header -->
      <timeline-scale-header [formatter]="scaleGenerator.formatter" [scale]="scale"></timeline-scale-header>
  
      <!-- seperator -->
      <div *ngFor="let date of scale?.columns; index as i" class="absolute top-16 h-full w-px bg-borderline" [style.right.px]="48 * (i + 1)" [style.height]="'calc(100% - ' + 64 + 'px)'"></div>

      <!-- date marker -->
      <timeline-date-marker *ngIf="showDateMarker" class="absolute top-0 h-full" [scale]="scale" [leftPosition]="dateMarkerLeftPosition"></timeline-date-marker>

      <!-- items -->
      <div class="absolute top-16 mt-2 flex flex-col h-auto" *ngIf="(lanes$ | async) as lanes">
        <ng-container *ngFor="let lane of lanes; trackBy: _trackById;">
          <ng-container *ngIf="lane.sub" [ngTemplateOutlet]="itemsIterationTemplate" [ngTemplateOutletContext]="{$implicit: lane}"></ng-container>
          <ng-container *ngIf="lane.items" [ngTemplateOutlet]="itemTemplate" [ngTemplateOutletContext]="{$implicit: lane}"></ng-container>      
        </ng-container>
      </div>
    </div>
  </div>

<ng-template #itemsIterationTemplate let-lane>
  <ng-container *ngIf="lane.isExpanded">
    <div *ngFor="let sub of (lane.sub || []); trackBy: _trackById;">
      <ng-container [ngTemplateOutlet]="itemTemplate" [ngTemplateOutletContext]="{$implicit: sub}"></ng-container>
      <!-- <ng-container [ngTemplateOutlet]="itemsIterationTemplate" [ngTemplateOutletContext]="{$implicit: sub}"></ng-container> -->
    </div>
  </ng-container>
</ng-template>

<ng-template #itemTemplate let-lane>
  <div class="relative flex flex-row h-12">
    <!-- single item -->
    <div *ngFor="let item of lane.items">
      <timeline-item [item]="item" [scale]="scale" (itemResized)="_onItemResized($event.event, $event.item)" (itemMoved)="_onItemMoved($event.event, $event.item)"></timeline-item>
    </div>
    <!-- error item -->
    <!-- <div *ngFor="let error of lane.errorItems">
      <timeline-erroritem [item]="error" [scale]="scale"></timeline-erroritem>
    </div> -->
  </div>
</ng-template>